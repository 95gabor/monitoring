logging {
  // level  = "debug"
  format = "logfmt"
}

prometheus.remote_write "grafana_cloud" {
  endpoint {
    url = env("PROM_URL")

    basic_auth {
      username = env("PROM_USER")
      password = env("PROM_PASSWORD")
    }
  }

  external_labels = {
    "domain" = env("INSTANCE_NAME"),
  }
}

prometheus.exporter.unix "nas" {
  rootfs_path           = "/host/root"
  sysfs_path            = "/host/sys"
  procfs_path           = "/host/proc"
  
  filesystem {
    mount_points_exclude  = "^/(rootfs/)?(dev|etc|host|proc|run|sys|volume1)($$|/)"
  }
}

prometheus.scrape "node_exporter" {
  targets    = prometheus.exporter.unix.nas.targets
  forward_to = [prometheus.remote_write.grafana_cloud.receiver]
}

prometheus.scrape "router" {
  targets = [
    { "__address__" = "192.168.1.1:9100", "instance" = "router" },
  ]
  forward_to = [prometheus.remote_write.grafana_cloud.receiver]
}
